<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="me.zhengjie.modules.opl.mapper.QueuesToDeptMapper">

    <!--获取明细下人员数据-->
    <select id="findByQueueId" resultType="me.zhengjie.modules.opl.service.dto.UserForShow">
        SELECT t3.FUserId as userId,t3.FUserName as userName,t3.FHumanName as humanName,
        t4.FDeptName as deptName,t1.code,t1.name,t1.id
        FROM trequestqueues t1 LEFT JOIN
        queuesToDept t2 ON t1.id =t2.queuesId
        LEFT JOIN tsysdept t4 ON t2.sourceId = t4.FDeptId
		LEFT JOIN tsysuser t3 ON t3.FDeptId = t4.FSourceCode
        WHERE t2.type =0 and t1.id = #{id}
        UNION
        SELECT t3.FUserId as userId,t3.FUserName as userName,t3.FHumanName as humanName,
        t4.FDeptName as deptName,t1.code,t1.name,t1.id
        FROM trequestqueues t1 LEFT JOIN
        queuesToDept t2 ON t1.id =t2.queuesId
        LEFT JOIN tsysuser t3 ON t2.sourceId = t3.FUserId
		 LEFT JOIN tsysdept t4 ON t4.FSourceCode = t3.FDeptId
        WHERE t2.type =1 and t1.id = #{id}
    </select>

    <!--根据部门id获取所有的人员-->
    <select id="findAllUserByDeptId" resultType="me.zhengjie.modules.opl.service.dto.UserForShow">
        SELECT t1.FUserId as userId,t1.FUserName as userName,t1.FHumanName as humanName,
        t2.FDeptId as deptId,t2.FDeptName as deptName  FROM tsysuser t1
         LEFT JOIN tsysdept t2 ON t1.FDeptId = t2.FSourceCode
         WHERE t2.FDeptId =#{deptId}
    </select>


    <!--新增-->
    <insert id="insert" parameterType="me.zhengjie.modules.opl.domain.QueuesToDept">
        INSERT INTO queuesToDept(queuesId,sourceId,type,status,
        createDateTime,createUserId)
        VALUES(#{queuesId},#{sourceId},#{type},#{status},
        #{createDateTime,jdbcType=TIMESTAMP},#{createUserId})
    </insert>

    <!--批量新增-->
    <insert id="batchInsert" parameterType="java.util.List" useGeneratedKeys="true">
        INSERT INTO queuesToDept(queuesId,sourceId,type,status,
        createDateTime,createUserId)
        <foreach collection="list" item="item" index="index" separator="," >
        VALUES (#{item.queuesId},#{item.sourceId},#{item.type},#{item.status},
        #{item.createDateTime,jdbcType=TIMESTAMP},#{item.createUserId})
        </foreach>
    </insert>

    <!--更新-->
    <update id="update" parameterType="me.zhengjie.modules.opl.domain.QueuesToDept">
        UPDATE queuesToDept SET queuesId=#{queuesId},
        sourceId=#{sourceId},type=#{type},status=#{status},
        modifyDateTime=#{modifyDateTime,jdbcType=TIMESTAMP},modifyUserId=#{modifyUserId}
        WHERE id = #{id}
    </update>

    <!--批量更新-->
    <update id="batchUpdate" parameterType="java.util.List" useGeneratedKeys="true">
        <foreach collection="list" item="item" index="index" separator="," >
        UPDATE queuesToDept SET queuesId=#{item.queuesId},
        sourceId=#{item.sourceId},type=#{item.type},status=#{item.status},
        modifyDateTime=#{item.modifyDateTime,jdbcType=TIMESTAMP},modifyUserId=#{item.modifyUserId}
        WHERE id = #{item.id}
        </foreach>
    </update>

    <!--根据id删除-->
    <delete id="delete" parameterType="java.lang.Integer">
        DELETE FROM queuesToDept WHERE id = #{id}
    </delete>

    <!--根据支持组id删除-->
    <delete id="deleteByQueue">
        DELETE FROM queuesToDept WHERE queuesId = #{queuesId}
    </delete>

</mapper>