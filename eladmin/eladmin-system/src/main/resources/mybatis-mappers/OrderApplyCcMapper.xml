<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="me.zhengjie.modules.opl.mapper.OrderApplyCcMapper">

    <!--新增-->
    <insert id="insert" parameterType="me.zhengjie.modules.opl.domain.OrderApplyCc">
        INSERT INTO orderApplyCc(transId,empId,ccType,createDateTime,createUserId,originalType)
        VALUES (#{transId},#{empId},#{ccType},#{createDateTime},#{createUserId},#{originalType})
    </insert>

    <!--修改-->
    <update id="update" parameterType="me.zhengjie.modules.opl.domain.OrderApplyCc">
        UPDATE orderApplyCc SET transId=#{transId},empId=#{empId},ccType=#{ccType},
        modifyDateTime=#{modifyDateTime},modifyUserId=#{modifyUserId},originalType=#{originalType}
        WHERE id = #{id}
    </update>

    <!--删除-->
    <delete id="delete" parameterType="java.lang.Integer">
        DELETE FROM orderApplyCc WHERE id =#{id}
    </delete>

    <!--根据有抄送的工单id查询-->
    <select id="findCcByTransId" resultType="me.zhengjie.modules.opl.service.dto.OrderApplyCcDto">
        SELECT t1.*,t2.FHumanName as humanName,t2.FUserName as userName,t2.FEmail as email FROM orderApplyCc t1
         LEFT JOIN tsysuser t2 ON t1.empId = t2.FUserId
         LEFT JOIN crm_work_order t3 ON t1.transId = t3.id
        WHERE t1.transId = #{transId}
    </select>

    <!--根据有抄送的人员id查询-->
    <select id="findCcByEmpId" resultType="me.zhengjie.modules.opl.service.dto.OrderApplyCcDto">
        SELECT t1.*,t2.FHumanName as humanName,t2.FUserName as userName,t2.FEmail as email FROM orderApplyCc t1
         LEFT JOIN sys_user t2 ON t1.empId = t2.user_id
         LEFT JOIN crm_work_order t3 ON t1.transId = t3.id
         WHERE t1.empId = #{empId}
    </select>

    <!-- 主表数据 -->
    <select id="findMasterOrderCcByEmpId" resultType="me.zhengjie.modules.opl.service.dto.CrmWorkOrderDto">
        SELECT t1.* FROM crm_work_order t1
        WHERE exists( SELECT t2.* FROM orderApplyCc t2 WHERE t2.transId=t1.id
         AND originalType=0 AND t2.empId=#{empId})
    </select>

    <!-- 附表数据 -->
    <select id="findSubOrderCcByEmpId" resultType="me.zhengjie.modules.opl.service.dto.SubOrderDto">
        SELECT t1.* FROM subOrder t1
        WHERE exists( SELECT t2.* FROM orderApplyCc t2 WHERE t2.transId=t1.id
         AND originalType=1 AND t2.empId=#{empId})
    </select>

    <select id="findMasterOrderCcByEmpId2" resultType="me.zhengjie.modules.opl.service.dto.CrmWorkOrderDto">
        SELECT t1.* FROM crm_work_order t1
        WHERE exists( SELECT t2.* FROM orderApplyCc t2 WHERE t2.transId=t1.id
        AND originalType=0 AND t2.empId=#{empId})

        <if test="topic!=null and topic !=''">
            AND t1.topic LIKE concat('%',#{topic},'%')
        </if>

        <if test="serialNo!=null and serialNo!=''">
            AND t1.serial_no LIKE concat('%',#{serialNo},'%')
        </if>

        <if test="orderStatusList!=null and orderStatusList.size &gt; 0">
            AND t1.order_status in
            <foreach collection="orderStatusList" item="orderStatus" open="(" separator="," close=")">
                #{orderStatus}
            </foreach>
        </if>

        <if test="workOrderType!=null">
            AND t1.work_order_type = #{workOrderType}
        </if>

        <if test="startTime != null ">
            AND t1.created_at &gt;= #{startTime}
        </if>

        <if test="endTime != null  ">
            AND t1.created_at &lt;= #{endTime}
        </if>
    </select>


</mapper>